{% extends "base.html" %}

{% block title %}Dashboard - DML ST{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Inicio</h1>

    {% set role = user.role %}

    {% if role == 'RAYPAC' %}
    <div class="row mb-4">
        <div class="col-md-3">
            <a href="{{ url_for('raypac_list') }}" class="text-decoration-none text-dark">
                <div class="card text-center shadow-sm position-relative">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-box-seam"></i> Equipos registrados</h5>
                        <h2 class="text-primary">{{ stats.equipos_registrados }}</h2>
                        <span class="stretched-link"></span>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-3">
            <a href="{{ url_for('raypac_list') }}" class="text-decoration-none text-dark">
                <div class="card text-center shadow-sm position-relative">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-truck"></i> Sin remito</h5>
                        <h2 class="text-warning">{{ stats.equipos_sin_remito }}</h2>
                        <span class="stretched-link"></span>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-3">
            <a href="{{ url_for('envios_list') }}" class="text-decoration-none text-dark">
                <div class="card text-center shadow-sm position-relative">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-send"></i> Envíos pendientes</h5>
                        <h2 class="text-info">{{ stats.envios_pendientes }}</h2>
                        <span class="stretched-link"></span>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-3">
            <a href="{{ url_for('stock_list') }}" class="text-decoration-none text-dark">
                <div class="card text-center shadow-sm position-relative">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-exclamation-triangle"></i> Stock RAYPAC ≤2</h5>
                        <h2 class="text-danger">{{ stats.stock_bajo }}</h2>
                        <span class="stretched-link"></span>
                    </div>
                </div>
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">Acciones Rápidas</h5>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        <a href="{{ url_for('raypac_new') }}" class="list-group-item list-group-item-action"><i class="bi bi-plus-circle"></i> Nuevo Ingreso RAYPAC</a>
                        <a href="{{ url_for('raypac_list') }}" class="list-group-item list-group-item-action"><i class="bi bi-box-seam"></i> Ver ingresos RAYPAC</a>
                        <a href="{{ url_for('envios_new') }}" class="list-group-item list-group-item-action"><i class="bi bi-truck"></i> Enviar repuestos a DML</a>
                        <a href="{{ url_for('stock_list') }}" class="list-group-item list-group-item-action"><i class="bi bi-bag-check"></i> Stock RAYPAC</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-light d-flex align-items-center">
                    <h5 class="mb-0">Notificaciones</h5>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-truck"></i> Ingresos sin remito</span>
                            <span class="badge bg-warning text-dark">{{ stats.equipos_sin_remito }}</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-send"></i> Envíos pendientes a DML</span>
                            <span class="badge bg-info text-dark">{{ stats.envios_pendientes }}</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-exclamation-triangle"></i> Repuestos en alerta (≤2)</span>
                            <span class="badge bg-danger">{{ stats.stock_bajo }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% elif role == 'DML_REPUESTOS' %}
    <div class="row mb-4">
        <div class="col-md-3">
            <a href="{{ url_for('stock_list') }}" class="text-decoration-none text-dark">
                <div class="card text-center shadow-sm position-relative">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-exclamation-triangle"></i> Stock DML ≤2</h5>
                        <h2 class="text-danger">{{ stats.stock_bajo }}</h2>
                        <span class="stretched-link"></span>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-3">
            <a href="{{ url_for('envios_list') }}" class="text-decoration-none text-dark">
                <div class="card text-center shadow-sm position-relative">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-truck"></i> Envíos pendientes</h5>
                        <h2 class="text-warning">{{ stats.envios_pendientes }}</h2>
                        <span class="stretched-link"></span>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-3">
            <a href="{{ url_for('dml_list') }}" class="text-decoration-none text-dark">
                <div class="card text-center shadow-sm position-relative">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-clock-history"></i> Espera repuestos</h5>
                        <h2 class="text-info">{{ stats.fichas_espera_repuestos }}</h2>
                        <span class="stretched-link"></span>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-3">
            <a href="{{ url_for('tickets_list') }}" class="text-decoration-none text-dark">
                <div class="card text-center shadow-sm position-relative">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-ticket-detailed"></i> Tickets activos</h5>
                        <h2 class="text-primary">{{ stats.tickets_activos }}</h2>
                        <span class="stretched-link"></span>
                    </div>
                </div>
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">Acciones Rápidas</h5>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        <a href="{{ url_for('stock_list') }}" class="list-group-item list-group-item-action"><i class="bi bi-bag-check"></i> Stock DML</a>
                        <a href="{{ url_for('stock_new') }}" class="list-group-item list-group-item-action"><i class="bi bi-plus-circle"></i> Ingresar repuesto</a>
                        <a href="{{ url_for('estadisticas') }}" class="list-group-item list-group-item-action"><i class="bi bi-graph-up"></i> Estadísticas de repuestos</a>
                        <a href="{{ url_for('envios_list') }}" class="list-group-item list-group-item-action"><i class="bi bi-truck"></i> Recepcionar envíos</a>
                        <a href="{{ url_for('dml_list') }}" class="list-group-item list-group-item-action"><i class="bi bi-wrench"></i> Fichas ST</a>
                        <a href="{{ url_for('tickets_list') }}" class="list-group-item list-group-item-action"><i class="bi bi-ticket-detailed"></i> Tickets</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-light d-flex align-items-center">
                    <h5 class="mb-0">Notificaciones</h5>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-truck"></i> Envíos pendientes a recibir</span>
                            <span class="badge bg-warning text-dark">{{ stats.envios_pendientes }}</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-exclamation-triangle"></i> Repuestos DML en alerta (≤2)</span>
                            <span class="badge bg-danger">{{ stats.stock_bajo }}</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-clock-history"></i> Fichas esperando repuestos</span>
                            <span class="badge bg-info text-dark">{{ stats.fichas_espera_repuestos }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% elif role == 'DML_ST' %}
    <div class="row mb-4">
        <div class="col-md-3">
            <a href="{{ url_for('dml_list') }}" class="text-decoration-none text-dark">
                <div class="card text-center shadow-sm position-relative">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-eye"></i> Revisión inicial</h5>
                        <h2 class="text-info">{{ stats.fichas_revision_inicial }}</h2>
                        <span class="stretched-link"></span>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-3">
            <a href="{{ url_for('dml_list') }}" class="text-decoration-none text-dark">
                <div class="card text-center shadow-sm position-relative">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-wrench"></i> En reparación</h5>
                        <h2 class="text-primary">{{ stats.fichas_en_reparacion }}</h2>
                        <span class="stretched-link"></span>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-3">
            <a href="{{ url_for('dml_list') }}" class="text-decoration-none text-dark">
                <div class="card text-center shadow-sm position-relative">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-clock-history"></i> Espera repuestos</h5>
                        <h2 class="text-warning">{{ stats.fichas_espera_repuestos }}</h2>
                        <span class="stretched-link"></span>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-3">
            <a href="{{ url_for('dml_list') }}" class="text-decoration-none text-dark">
                <div class="card text-center shadow-sm position-relative">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-check-circle"></i> Listas para retirar</h5>
                        <h2 class="text-success">{{ stats.fichas_listas }}</h2>
                        <span class="stretched-link"></span>
                    </div>
                </div>
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">Acciones Rápidas</h5>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        <a href="{{ url_for('dml_list') }}" class="list-group-item list-group-item-action"><i class="bi bi-wrench"></i> Fichas ST</a>
                        <a href="{{ url_for('tickets_list') }}" class="list-group-item list-group-item-action"><i class="bi bi-ticket-detailed"></i> Tickets</a>
                        <a href="{{ url_for('estadisticas') }}" class="list-group-item list-group-item-action"><i class="bi bi-bar-chart"></i> Estadísticas</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-light d-flex align-items-center">
                    <h5 class="mb-0">Notificaciones</h5>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-eye"></i> Fichas en revisión inicial</span>
                            <span class="badge bg-info">{{ stats.fichas_revision_inicial }}</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-wrench"></i> Fichas en reparación</span>
                            <span class="badge bg-primary">{{ stats.fichas_en_reparacion }}</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-clock-history"></i> Fichas esperando repuestos</span>
                            <span class="badge bg-warning text-dark">{{ stats.fichas_espera_repuestos }}</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-check-circle"></i> Listas para retirar</span>
                            <span class="badge bg-success">{{ stats.fichas_listas }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% else %} {# ADMIN #}
    <div class="row mb-4">
        <div class="col-md-3">
            <a href="{{ url_for('raypac_list') }}" class="text-decoration-none text-dark">
                <div class="card text-center shadow-sm position-relative">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-box-seam"></i> Equipos RAYPAC</h5>
                        <h2 class="text-primary">{{ stats.equipos_raypac }}</h2>
                        <span class="stretched-link"></span>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-3">
            <a href="{{ url_for('dml_list') }}" class="text-decoration-none text-dark">
                <div class="card text-center shadow-sm position-relative">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-wrench"></i> Fichas abiertas</h5>
                        <h2 class="text-warning">{{ stats.fichas_abiertas }}</h2>
                        <span class="stretched-link"></span>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-3">
            <a href="{{ url_for('envios_list') }}" class="text-decoration-none text-dark">
                <div class="card text-center shadow-sm position-relative">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-truck"></i> Envíos pendientes</h5>
                        <h2 class="text-info">{{ stats.envios_pendientes }}</h2>
                        <span class="stretched-link"></span>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-3">
            <a href="{{ url_for('stock_list') }}" class="text-decoration-none text-dark">
                <div class="card text-center shadow-sm position-relative">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-exclamation-triangle"></i> Stock ≤2 (todas ubic.)</h5>
                        <h2 class="text-danger">{{ stats.stock_bajo_total }}</h2>
                        <span class="stretched-link"></span>
                    </div>
                </div>
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">Acciones Rápidas</h5>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        <a href="{{ url_for('raypac_new') }}" class="list-group-item list-group-item-action"><i class="bi bi-plus-circle"></i> Nuevo ingreso RAYPAC</a>
                        <a href="{{ url_for('raypac_list') }}" class="list-group-item list-group-item-action"><i class="bi bi-box-seam"></i> Ver ingresos RAYPAC</a>
                        <a href="{{ url_for('dml_list') }}" class="list-group-item list-group-item-action"><i class="bi bi-wrench"></i> Fichas ST</a>
                        <a href="{{ url_for('envios_list') }}" class="list-group-item list-group-item-action"><i class="bi bi-truck"></i> Envíos</a>
                        <a href="{{ url_for('stock_list') }}" class="list-group-item list-group-item-action"><i class="bi bi-bag-check"></i> Stock</a>
                        <a href="{{ url_for('usuarios_list') }}" class="list-group-item list-group-item-action"><i class="bi bi-people"></i> Usuarios</a>
                        <a href="{{ url_for('estadisticas') }}" class="list-group-item list-group-item-action"><i class="bi bi-bar-chart"></i> Estadísticas</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-light d-flex align-items-center">
                    <h5 class="mb-0">Notificaciones</h5>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-box-seam"></i> Equipos RAYPAC cargados</span>
                            <span class="badge bg-primary">{{ stats.equipos_raypac }}</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-wrench"></i> Fichas abiertas</span>
                            <span class="badge bg-warning text-dark">{{ stats.fichas_abiertas }}</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-truck"></i> Envíos pendientes</span>
                            <span class="badge bg-info text-dark">{{ stats.envios_pendientes }}</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-exclamation-triangle"></i> Stock ≤2 (todas ubic.)</span>
                            <span class="badge bg-danger">{{ stats.stock_bajo_total }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
